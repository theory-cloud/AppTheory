"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AppTheoryQueueProcessor = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const constructs_1 = require("constructs");
const queue_1 = require("./queue");
const queue_consumer_1 = require("./queue-consumer");
/**
 * A combined queue + consumer construct for SQS processing workflows.
 *
 * This is a convenience construct that combines AppTheoryQueue and AppTheoryQueueConsumer
 * into a single, easy-to-use pattern. For more control, use the individual constructs.
 *
 * @example
 * // Basic processor (backwards compatible)
 * new AppTheoryQueueProcessor(stack, 'Processor', {
 *   consumer: myFunction,
 * });
 *
 * @example
 * // Processor with DLQ
 * new AppTheoryQueueProcessor(stack, 'Processor', {
 *   consumer: myFunction,
 *   enableDlq: true,
 *   maxReceiveCount: 5,
 * });
 *
 * @example
 * // Processor with full options
 * new AppTheoryQueueProcessor(stack, 'Processor', {
 *   consumer: myFunction,
 *   queueName: 'my-queue',
 *   enableDlq: true,
 *   batchSize: 100,
 *   maxBatchingWindow: Duration.seconds(10),
 *   reportBatchItemFailures: true,
 *   maxConcurrency: 50,
 * });
 */
class AppTheoryQueueProcessor extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        // Determine if we should use legacy queueProps or new props
        const useLegacyProps = props.queueProps !== undefined;
        // Create the queue using AppTheoryQueue
        // For backwards compatibility, DLQ is disabled by default (original behavior)
        this.queueConstruct = new queue_1.AppTheoryQueue(this, "AppTheoryQueue", {
            queueName: useLegacyProps ? props.queueProps?.queueName : props.queueName,
            visibilityTimeout: useLegacyProps
                ? props.queueProps?.visibilityTimeout
                : props.visibilityTimeout,
            enableDlq: props.enableDlq ?? false, // Backwards compatible: no DLQ by default
            maxReceiveCount: props.maxReceiveCount,
            removalPolicy: props.removalPolicy,
        });
        this.queue = this.queueConstruct.queue;
        this.deadLetterQueue = this.queueConstruct.deadLetterQueue;
        // Create the consumer using AppTheoryQueueConsumer
        this.consumerConstruct = new queue_consumer_1.AppTheoryQueueConsumer(this, "AppTheoryConsumer", {
            queue: this.queue,
            consumer: props.consumer,
            batchSize: props.batchSize,
            maxBatchingWindow: props.maxBatchingWindow,
            reportBatchItemFailures: props.reportBatchItemFailures,
            maxConcurrency: props.maxConcurrency,
            enabled: props.enabled,
            grantConsumeMessages: true,
        });
    }
}
exports.AppTheoryQueueProcessor = AppTheoryQueueProcessor;
_a = JSII_RTTI_SYMBOL_1;
AppTheoryQueueProcessor[_a] = { fqn: "@theory-cloud/apptheory-cdk.AppTheoryQueueProcessor", version: "0.5.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVldWUtcHJvY2Vzc29yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicXVldWUtcHJvY2Vzc29yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBR0EsMkNBQXVDO0FBQ3ZDLG1DQUF5QztBQUN6QyxxREFBMEQ7QUFvRjFEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBK0JHO0FBQ0gsTUFBYSx1QkFBd0IsU0FBUSxzQkFBUztJQXFCcEQsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFtQztRQUMzRSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpCLDREQUE0RDtRQUM1RCxNQUFNLGNBQWMsR0FBRyxLQUFLLENBQUMsVUFBVSxLQUFLLFNBQVMsQ0FBQztRQUV0RCx3Q0FBd0M7UUFDeEMsOEVBQThFO1FBQzlFLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxzQkFBYyxDQUFDLElBQUksRUFBRSxnQkFBZ0IsRUFBRTtZQUMvRCxTQUFTLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVM7WUFDekUsaUJBQWlCLEVBQUUsY0FBYztnQkFDL0IsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsaUJBQWlCO2dCQUNyQyxDQUFDLENBQUMsS0FBSyxDQUFDLGlCQUFpQjtZQUMzQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVMsSUFBSSxLQUFLLEVBQUUsMENBQTBDO1lBQy9FLGVBQWUsRUFBRSxLQUFLLENBQUMsZUFBZTtZQUN0QyxhQUFhLEVBQUUsS0FBSyxDQUFDLGFBQWE7U0FDbkMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQztRQUN2QyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDO1FBRTNELG1EQUFtRDtRQUNuRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSx1Q0FBc0IsQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLEVBQUU7WUFDN0UsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO1lBQ2pCLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUTtZQUN4QixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7WUFDMUIsaUJBQWlCLEVBQUUsS0FBSyxDQUFDLGlCQUFpQjtZQUMxQyx1QkFBdUIsRUFBRSxLQUFLLENBQUMsdUJBQXVCO1lBQ3RELGNBQWMsRUFBRSxLQUFLLENBQUMsY0FBYztZQUNwQyxPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU87WUFDdEIsb0JBQW9CLEVBQUUsSUFBSTtTQUMzQixDQUFDLENBQUM7SUFDTCxDQUFDOztBQXJESCwwREFzREMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEdXJhdGlvbiwgUmVtb3ZhbFBvbGljeSB9IGZyb20gXCJhd3MtY2RrLWxpYlwiO1xuaW1wb3J0IHR5cGUgKiBhcyBsYW1iZGEgZnJvbSBcImF3cy1jZGstbGliL2F3cy1sYW1iZGFcIjtcbmltcG9ydCB0eXBlICogYXMgc3FzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3Mtc3FzXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tIFwiY29uc3RydWN0c1wiO1xuaW1wb3J0IHsgQXBwVGhlb3J5UXVldWUgfSBmcm9tIFwiLi9xdWV1ZVwiO1xuaW1wb3J0IHsgQXBwVGhlb3J5UXVldWVDb25zdW1lciB9IGZyb20gXCIuL3F1ZXVlLWNvbnN1bWVyXCI7XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgdGhlIEFwcFRoZW9yeVF1ZXVlUHJvY2Vzc29yIGNvbnN0cnVjdC5cbiAqXG4gKiBUaGlzIGNvbnN0cnVjdCBtYWludGFpbnMgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCB0aGUgb3JpZ2luYWwgQVBJXG4gKiB3aGlsZSBsZXZlcmFnaW5nIHRoZSBuZXcgY29tcG9zYWJsZSBBcHBUaGVvcnlRdWV1ZSBhbmQgQXBwVGhlb3J5UXVldWVDb25zdW1lciBjb25zdHJ1Y3RzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFwcFRoZW9yeVF1ZXVlUHJvY2Vzc29yUHJvcHMge1xuICAvKipcbiAgICogVGhlIExhbWJkYSBmdW5jdGlvbiB0aGF0IHdpbGwgY29uc3VtZSBtZXNzYWdlcyBmcm9tIHRoZSBxdWV1ZS5cbiAgICovXG4gIHJlYWRvbmx5IGNvbnN1bWVyOiBsYW1iZGEuSUZ1bmN0aW9uO1xuXG4gIC8qKlxuICAgKiBQcm9wZXJ0aWVzIGZvciB0aGUgdW5kZXJseWluZyBTUVMgcXVldWUuXG4gICAqIEBkZXByZWNhdGVkIFVzZSBxdWV1ZU5hbWUsIHZpc2liaWxpdHlUaW1lb3V0LCBhbmQgb3RoZXIgc3BlY2lmaWMgcHJvcHMgaW5zdGVhZFxuICAgKi9cbiAgcmVhZG9ubHkgcXVldWVQcm9wcz86IHNxcy5RdWV1ZVByb3BzO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgcXVldWUuXG4gICAqIEBkZWZhdWx0IC0gQ2xvdWRGb3JtYXRpb24tZ2VuZXJhdGVkIG5hbWVcbiAgICovXG4gIHJlYWRvbmx5IHF1ZXVlTmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHZpc2liaWxpdHkgdGltZW91dCBmb3IgbWVzc2FnZXMgaW4gdGhlIHF1ZXVlLlxuICAgKiBAZGVmYXVsdCBEdXJhdGlvbi5zZWNvbmRzKDMwKVxuICAgKi9cbiAgcmVhZG9ubHkgdmlzaWJpbGl0eVRpbWVvdXQ/OiBEdXJhdGlvbjtcblxuICAvKipcbiAgICogV2hldGhlciB0byBlbmFibGUgYSBEZWFkIExldHRlciBRdWV1ZSAoRExRKS5cbiAgICogQGRlZmF1bHQgZmFsc2UgKGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoIG9yaWdpbmFsIGJlaGF2aW9yKVxuICAgKi9cbiAgcmVhZG9ubHkgZW5hYmxlRGxxPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogVGhlIG1heGltdW0gbnVtYmVyIG9mIHRpbWVzIGEgbWVzc2FnZSBjYW4gYmUgcmVjZWl2ZWQgYmVmb3JlIGJlaW5nIHNlbnQgdG8gdGhlIERMUS5cbiAgICogT25seSBhcHBsaWNhYmxlIHdoZW4gZW5hYmxlRGxxIGlzIHRydWUuXG4gICAqIEBkZWZhdWx0IDNcbiAgICovXG4gIHJlYWRvbmx5IG1heFJlY2VpdmVDb3VudD86IG51bWJlcjtcblxuICAvKipcbiAgICogVGhlIG1heGltdW0gbnVtYmVyIG9mIHJlY29yZHMgdG8gcmV0cmlldmUgcGVyIGJhdGNoLlxuICAgKiBAZGVmYXVsdCAxMFxuICAgKi9cbiAgcmVhZG9ubHkgYmF0Y2hTaXplPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgbWF4aW11bSBhbW91bnQgb2YgdGltZSB0byB3YWl0IGZvciBhIGJhdGNoIHRvIGJlIGdhdGhlcmVkLlxuICAgKiBAZGVmYXVsdCAtIE5vIGJhdGNoaW5nIHdpbmRvd1xuICAgKi9cbiAgcmVhZG9ubHkgbWF4QmF0Y2hpbmdXaW5kb3c/OiBEdXJhdGlvbjtcblxuICAvKipcbiAgICogV2hldGhlciB0byByZXBvcnQgYmF0Y2ggaXRlbSBmYWlsdXJlcy5cbiAgICogV2hlbiBlbmFibGVkLCB0aGUgZnVuY3Rpb24gc2hvdWxkIHJldHVybiBhIHBhcnRpYWwgZmFpbHVyZSByZXNwb25zZS5cbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IHJlcG9ydEJhdGNoSXRlbUZhaWx1cmVzPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogVGhlIG1heGltdW0gY29uY3VycmVuY3kgc2V0dGluZyBsaW1pdHMgdGhlIG51bWJlciBvZiBjb25jdXJyZW50IGluc3RhbmNlcyBvZiB0aGUgZnVuY3Rpb24uXG4gICAqIFZhbGlkIHJhbmdlOiAyLTEwMDAuXG4gICAqIEBkZWZhdWx0IC0gTm8gY29uY3VycmVuY3kgbGltaXRcbiAgICovXG4gIHJlYWRvbmx5IG1heENvbmN1cnJlbmN5PzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBldmVudCBzb3VyY2UgbWFwcGluZyBpcyBlbmFibGVkLlxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICByZWFkb25seSBlbmFibGVkPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogVGhlIHJlbW92YWwgcG9saWN5IGZvciB0aGUgcXVldWUocykuXG4gICAqIEBkZWZhdWx0IFJlbW92YWxQb2xpY3kuREVTVFJPWVxuICAgKi9cbiAgcmVhZG9ubHkgcmVtb3ZhbFBvbGljeT86IFJlbW92YWxQb2xpY3k7XG59XG5cbi8qKlxuICogQSBjb21iaW5lZCBxdWV1ZSArIGNvbnN1bWVyIGNvbnN0cnVjdCBmb3IgU1FTIHByb2Nlc3Npbmcgd29ya2Zsb3dzLlxuICpcbiAqIFRoaXMgaXMgYSBjb252ZW5pZW5jZSBjb25zdHJ1Y3QgdGhhdCBjb21iaW5lcyBBcHBUaGVvcnlRdWV1ZSBhbmQgQXBwVGhlb3J5UXVldWVDb25zdW1lclxuICogaW50byBhIHNpbmdsZSwgZWFzeS10by11c2UgcGF0dGVybi4gRm9yIG1vcmUgY29udHJvbCwgdXNlIHRoZSBpbmRpdmlkdWFsIGNvbnN0cnVjdHMuXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEJhc2ljIHByb2Nlc3NvciAoYmFja3dhcmRzIGNvbXBhdGlibGUpXG4gKiBuZXcgQXBwVGhlb3J5UXVldWVQcm9jZXNzb3Ioc3RhY2ssICdQcm9jZXNzb3InLCB7XG4gKiAgIGNvbnN1bWVyOiBteUZ1bmN0aW9uLFxuICogfSk7XG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFByb2Nlc3NvciB3aXRoIERMUVxuICogbmV3IEFwcFRoZW9yeVF1ZXVlUHJvY2Vzc29yKHN0YWNrLCAnUHJvY2Vzc29yJywge1xuICogICBjb25zdW1lcjogbXlGdW5jdGlvbixcbiAqICAgZW5hYmxlRGxxOiB0cnVlLFxuICogICBtYXhSZWNlaXZlQ291bnQ6IDUsXG4gKiB9KTtcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gUHJvY2Vzc29yIHdpdGggZnVsbCBvcHRpb25zXG4gKiBuZXcgQXBwVGhlb3J5UXVldWVQcm9jZXNzb3Ioc3RhY2ssICdQcm9jZXNzb3InLCB7XG4gKiAgIGNvbnN1bWVyOiBteUZ1bmN0aW9uLFxuICogICBxdWV1ZU5hbWU6ICdteS1xdWV1ZScsXG4gKiAgIGVuYWJsZURscTogdHJ1ZSxcbiAqICAgYmF0Y2hTaXplOiAxMDAsXG4gKiAgIG1heEJhdGNoaW5nV2luZG93OiBEdXJhdGlvbi5zZWNvbmRzKDEwKSxcbiAqICAgcmVwb3J0QmF0Y2hJdGVtRmFpbHVyZXM6IHRydWUsXG4gKiAgIG1heENvbmN1cnJlbmN5OiA1MCxcbiAqIH0pO1xuICovXG5leHBvcnQgY2xhc3MgQXBwVGhlb3J5UXVldWVQcm9jZXNzb3IgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuICAvKipcbiAgICogVGhlIG1haW4gU1FTIHF1ZXVlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHF1ZXVlOiBzcXMuSVF1ZXVlO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5kZXJseWluZyBBcHBUaGVvcnlRdWV1ZSBjb25zdHJ1Y3QuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcXVldWVDb25zdHJ1Y3Q6IEFwcFRoZW9yeVF1ZXVlO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5kZXJseWluZyBBcHBUaGVvcnlRdWV1ZUNvbnN1bWVyIGNvbnN0cnVjdC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjb25zdW1lckNvbnN0cnVjdDogQXBwVGhlb3J5UXVldWVDb25zdW1lcjtcblxuICAvKipcbiAgICogVGhlIERlYWQgTGV0dGVyIFF1ZXVlLCBpZiBlbmFibGVkLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRlYWRMZXR0ZXJRdWV1ZT86IHNxcy5RdWV1ZTtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQXBwVGhlb3J5UXVldWVQcm9jZXNzb3JQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICAvLyBEZXRlcm1pbmUgaWYgd2Ugc2hvdWxkIHVzZSBsZWdhY3kgcXVldWVQcm9wcyBvciBuZXcgcHJvcHNcbiAgICBjb25zdCB1c2VMZWdhY3lQcm9wcyA9IHByb3BzLnF1ZXVlUHJvcHMgIT09IHVuZGVmaW5lZDtcblxuICAgIC8vIENyZWF0ZSB0aGUgcXVldWUgdXNpbmcgQXBwVGhlb3J5UXVldWVcbiAgICAvLyBGb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHksIERMUSBpcyBkaXNhYmxlZCBieSBkZWZhdWx0IChvcmlnaW5hbCBiZWhhdmlvcilcbiAgICB0aGlzLnF1ZXVlQ29uc3RydWN0ID0gbmV3IEFwcFRoZW9yeVF1ZXVlKHRoaXMsIFwiQXBwVGhlb3J5UXVldWVcIiwge1xuICAgICAgcXVldWVOYW1lOiB1c2VMZWdhY3lQcm9wcyA/IHByb3BzLnF1ZXVlUHJvcHM/LnF1ZXVlTmFtZSA6IHByb3BzLnF1ZXVlTmFtZSxcbiAgICAgIHZpc2liaWxpdHlUaW1lb3V0OiB1c2VMZWdhY3lQcm9wc1xuICAgICAgICA/IHByb3BzLnF1ZXVlUHJvcHM/LnZpc2liaWxpdHlUaW1lb3V0XG4gICAgICAgIDogcHJvcHMudmlzaWJpbGl0eVRpbWVvdXQsXG4gICAgICBlbmFibGVEbHE6IHByb3BzLmVuYWJsZURscSA/PyBmYWxzZSwgLy8gQmFja3dhcmRzIGNvbXBhdGlibGU6IG5vIERMUSBieSBkZWZhdWx0XG4gICAgICBtYXhSZWNlaXZlQ291bnQ6IHByb3BzLm1heFJlY2VpdmVDb3VudCxcbiAgICAgIHJlbW92YWxQb2xpY3k6IHByb3BzLnJlbW92YWxQb2xpY3ksXG4gICAgfSk7XG5cbiAgICB0aGlzLnF1ZXVlID0gdGhpcy5xdWV1ZUNvbnN0cnVjdC5xdWV1ZTtcbiAgICB0aGlzLmRlYWRMZXR0ZXJRdWV1ZSA9IHRoaXMucXVldWVDb25zdHJ1Y3QuZGVhZExldHRlclF1ZXVlO1xuXG4gICAgLy8gQ3JlYXRlIHRoZSBjb25zdW1lciB1c2luZyBBcHBUaGVvcnlRdWV1ZUNvbnN1bWVyXG4gICAgdGhpcy5jb25zdW1lckNvbnN0cnVjdCA9IG5ldyBBcHBUaGVvcnlRdWV1ZUNvbnN1bWVyKHRoaXMsIFwiQXBwVGhlb3J5Q29uc3VtZXJcIiwge1xuICAgICAgcXVldWU6IHRoaXMucXVldWUsXG4gICAgICBjb25zdW1lcjogcHJvcHMuY29uc3VtZXIsXG4gICAgICBiYXRjaFNpemU6IHByb3BzLmJhdGNoU2l6ZSxcbiAgICAgIG1heEJhdGNoaW5nV2luZG93OiBwcm9wcy5tYXhCYXRjaGluZ1dpbmRvdyxcbiAgICAgIHJlcG9ydEJhdGNoSXRlbUZhaWx1cmVzOiBwcm9wcy5yZXBvcnRCYXRjaEl0ZW1GYWlsdXJlcyxcbiAgICAgIG1heENvbmN1cnJlbmN5OiBwcm9wcy5tYXhDb25jdXJyZW5jeSxcbiAgICAgIGVuYWJsZWQ6IHByb3BzLmVuYWJsZWQsXG4gICAgICBncmFudENvbnN1bWVNZXNzYWdlczogdHJ1ZSxcbiAgICB9KTtcbiAgfVxufVxuXG4iXX0=