"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AppTheoryHostedZone = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const route53 = require("aws-cdk-lib/aws-route53");
const ssm = require("aws-cdk-lib/aws-ssm");
const constructs_1 = require("constructs");
class AppTheoryHostedZone extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        const zoneName = String(props.zoneName ?? "").trim();
        if (!zoneName) {
            throw new Error("AppTheoryHostedZone requires props.zoneName");
        }
        this.zoneName = zoneName;
        const importIfExists = props.importIfExists ?? false;
        const enableSsmExport = props.enableSsmExport ?? false;
        const enableCfnExport = props.enableCfnExport ?? false;
        if (importIfExists && props.existingZoneId) {
            this.hostedZone = route53.HostedZone.fromHostedZoneAttributes(this, "HostedZone", {
                hostedZoneId: props.existingZoneId,
                zoneName,
            });
            this.hostedZoneId = props.existingZoneId;
            this.isImported = true;
        }
        else {
            const zone = new route53.PublicHostedZone(this, "HostedZone", {
                zoneName,
                comment: props.comment,
            });
            this.hostedZone = zone;
            this.hostedZoneId = zone.hostedZoneId;
            this.isImported = false;
            if (props.tags) {
                for (const [key, value] of Object.entries(props.tags)) {
                    aws_cdk_lib_1.Tags.of(zone).add(key, value);
                }
            }
        }
        if (enableSsmExport) {
            const parameterName = props.ssmParameterPath ?? `/route53/zones/${zoneName}/id`;
            new ssm.StringParameter(this, "ZoneIdParameter", {
                parameterName,
                stringValue: this.hostedZoneId,
                description: `Hosted Zone ID for ${zoneName}`,
            });
        }
        if (enableCfnExport) {
            const exportName = props.cfnExportName ?? sanitizeCloudFormationExportName(`HostedZoneId-${zoneName}`);
            new aws_cdk_lib_1.CfnOutput(this, "ZoneIdOutput", {
                value: this.hostedZoneId,
                description: `Hosted Zone ID for ${zoneName}`,
                exportName,
            });
        }
    }
    nameServers() {
        if (this.isImported)
            return undefined;
        return this.hostedZone.hostedZoneNameServers;
    }
    addNsRecord(recordName, targetNameServers, ttl) {
        return new route53.NsRecord(this, `NSRecord-${sanitizeConstructIdSuffix(recordName)}`, {
            zone: this.hostedZone,
            recordName,
            values: targetNameServers,
            ttl,
        });
    }
    addCnameRecord(recordName, domainName, ttl) {
        return new route53.CnameRecord(this, `CNAMERecord-${sanitizeConstructIdSuffix(recordName)}`, {
            zone: this.hostedZone,
            recordName,
            domainName,
            ttl,
        });
    }
}
exports.AppTheoryHostedZone = AppTheoryHostedZone;
_a = JSII_RTTI_SYMBOL_1;
AppTheoryHostedZone[_a] = { fqn: "@theory-cloud/apptheory-cdk.AppTheoryHostedZone", version: "0.3.1" };
function sanitizeCloudFormationExportName(name) {
    const input = String(name ?? "").trim();
    if (!input)
        return "export";
    let out = "";
    let lastWasDash = false;
    for (const r of input) {
        const isAllowed = (r >= "a" && r <= "z") ||
            (r >= "A" && r <= "Z") ||
            (r >= "0" && r <= "9") ||
            r === ":" ||
            r === "-";
        if (isAllowed) {
            out += r;
            lastWasDash = r === "-";
            continue;
        }
        if (!lastWasDash) {
            out += "-";
            lastWasDash = true;
        }
    }
    out = out.replace(/^-+/, "").replace(/-+$/, "");
    return out ? out : "export";
}
function sanitizeConstructIdSuffix(input) {
    const raw = String(input ?? "").trim();
    if (!raw)
        return "record";
    const out = raw.replace(/[^a-zA-Z0-9]+/g, "-").replace(/^-+/, "").replace(/-+$/, "");
    return out ? out : "record";
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9zdGVkLXpvbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJob3N0ZWQtem9uZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLDZDQUF3RDtBQUN4RCxtREFBbUQ7QUFDbkQsMkNBQTJDO0FBQzNDLDJDQUF1QztBQWN2QyxNQUFhLG1CQUFvQixTQUFRLHNCQUFTO0lBTWhELFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBK0I7UUFDdkUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyRCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDZCxNQUFNLElBQUksS0FBSyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7UUFDakUsQ0FBQztRQUVELElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBRXpCLE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxjQUFjLElBQUksS0FBSyxDQUFDO1FBQ3JELE1BQU0sZUFBZSxHQUFHLEtBQUssQ0FBQyxlQUFlLElBQUksS0FBSyxDQUFDO1FBQ3ZELE1BQU0sZUFBZSxHQUFHLEtBQUssQ0FBQyxlQUFlLElBQUksS0FBSyxDQUFDO1FBRXZELElBQUksY0FBYyxJQUFJLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUMzQyxJQUFJLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsd0JBQXdCLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRTtnQkFDaEYsWUFBWSxFQUFFLEtBQUssQ0FBQyxjQUFjO2dCQUNsQyxRQUFRO2FBQ1QsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUMsY0FBYyxDQUFDO1lBQ3pDLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLENBQUM7YUFB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QUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztBQUM5QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2ZuT3V0cHV0LCBEdXJhdGlvbiwgVGFncyB9IGZyb20gXCJhd3MtY2RrLWxpYlwiO1xuaW1wb3J0ICogYXMgcm91dGU1MyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLXJvdXRlNTNcIjtcbmltcG9ydCAqIGFzIHNzbSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLXNzbVwiO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBBcHBUaGVvcnlIb3N0ZWRab25lUHJvcHMge1xuICByZWFkb25seSB6b25lTmFtZTogc3RyaW5nO1xuICByZWFkb25seSBjb21tZW50Pzogc3RyaW5nO1xuICByZWFkb25seSBpbXBvcnRJZkV4aXN0cz86IGJvb2xlYW47XG4gIHJlYWRvbmx5IGV4aXN0aW5nWm9uZUlkPzogc3RyaW5nO1xuICByZWFkb25seSBlbmFibGVTc21FeHBvcnQ/OiBib29sZWFuO1xuICByZWFkb25seSBzc21QYXJhbWV0ZXJQYXRoPzogc3RyaW5nO1xuICByZWFkb25seSBlbmFibGVDZm5FeHBvcnQ/OiBib29sZWFuO1xuICByZWFkb25seSBjZm5FeHBvcnROYW1lPzogc3RyaW5nO1xuICByZWFkb25seSB0YWdzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn1cblxuZXhwb3J0IGNsYXNzIEFwcFRoZW9yeUhvc3RlZFpvbmUgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuICBwdWJsaWMgcmVhZG9ubHkgaG9zdGVkWm9uZTogcm91dGU1My5JSG9zdGVkWm9uZTtcbiAgcHVibGljIHJlYWRvbmx5IGhvc3RlZFpvbmVJZDogc3RyaW5nO1xuICBwdWJsaWMgcmVhZG9ubHkgem9uZU5hbWU6IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IGlzSW1wb3J0ZWQ6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IEFwcFRoZW9yeUhvc3RlZFpvbmVQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICBjb25zdCB6b25lTmFtZSA9IFN0cmluZyhwcm9wcy56b25lTmFtZSA/PyBcIlwiKS50cmltKCk7XG4gICAgaWYgKCF6b25lTmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXBwVGhlb3J5SG9zdGVkWm9uZSByZXF1aXJlcyBwcm9wcy56b25lTmFtZVwiKTtcbiAgICB9XG5cbiAgICB0aGlzLnpvbmVOYW1lID0gem9uZU5hbWU7XG5cbiAgICBjb25zdCBpbXBvcnRJZkV4aXN0cyA9IHByb3BzLmltcG9ydElmRXhpc3RzID8/IGZhbHNlO1xuICAgIGNvbnN0IGVuYWJsZVNzbUV4cG9ydCA9IHByb3BzLmVuYWJsZVNzbUV4cG9ydCA/PyBmYWxzZTtcbiAgICBjb25zdCBlbmFibGVDZm5FeHBvcnQgPSBwcm9wcy5lbmFibGVDZm5FeHBvcnQgPz8gZmFsc2U7XG5cbiAgICBpZiAoaW1wb3J0SWZFeGlzdHMgJiYgcHJvcHMuZXhpc3Rpbmdab25lSWQpIHtcbiAgICAgIHRoaXMuaG9zdGVkWm9uZSA9IHJvdXRlNTMuSG9zdGVkWm9uZS5mcm9tSG9zdGVkWm9uZUF0dHJpYnV0ZXModGhpcywgXCJIb3N0ZWRab25lXCIsIHtcbiAgICAgICAgaG9zdGVkWm9uZUlkOiBwcm9wcy5leGlzdGluZ1pvbmVJZCxcbiAgICAgICAgem9uZU5hbWUsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuaG9zdGVkWm9uZUlkID0gcHJvcHMuZXhpc3Rpbmdab25lSWQ7XG4gICAgICB0aGlzLmlzSW1wb3J0ZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB6b25lID0gbmV3IHJvdXRlNTMuUHVibGljSG9zdGVkWm9uZSh0aGlzLCBcIkhvc3RlZFpvbmVcIiwge1xuICAgICAgICB6b25lTmFtZSxcbiAgICAgICAgY29tbWVudDogcHJvcHMuY29tbWVudCxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5ob3N0ZWRab25lID0gem9uZTtcbiAgICAgIHRoaXMuaG9zdGVkWm9uZUlkID0gem9uZS5ob3N0ZWRab25lSWQ7XG4gICAgICB0aGlzLmlzSW1wb3J0ZWQgPSBmYWxzZTtcblxuICAgICAgaWYgKHByb3BzLnRhZ3MpIHtcbiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocHJvcHMudGFncykpIHtcbiAgICAgICAgICBUYWdzLm9mKHpvbmUpLmFkZChrZXksIHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChlbmFibGVTc21FeHBvcnQpIHtcbiAgICAgIGNvbnN0IHBhcmFtZXRlck5hbWUgPSBwcm9wcy5zc21QYXJhbWV0ZXJQYXRoID8/IGAvcm91dGU1My96b25lcy8ke3pvbmVOYW1lfS9pZGA7XG4gICAgICBuZXcgc3NtLlN0cmluZ1BhcmFtZXRlcih0aGlzLCBcIlpvbmVJZFBhcmFtZXRlclwiLCB7XG4gICAgICAgIHBhcmFtZXRlck5hbWUsXG4gICAgICAgIHN0cmluZ1ZhbHVlOiB0aGlzLmhvc3RlZFpvbmVJZCxcbiAgICAgICAgZGVzY3JpcHRpb246IGBIb3N0ZWQgWm9uZSBJRCBmb3IgJHt6b25lTmFtZX1gLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGVuYWJsZUNmbkV4cG9ydCkge1xuICAgICAgY29uc3QgZXhwb3J0TmFtZSA9XG4gICAgICAgIHByb3BzLmNmbkV4cG9ydE5hbWUgPz8gc2FuaXRpemVDbG91ZEZvcm1hdGlvbkV4cG9ydE5hbWUoYEhvc3RlZFpvbmVJZC0ke3pvbmVOYW1lfWApO1xuXG4gICAgICBuZXcgQ2ZuT3V0cHV0KHRoaXMsIFwiWm9uZUlkT3V0cHV0XCIsIHtcbiAgICAgICAgdmFsdWU6IHRoaXMuaG9zdGVkWm9uZUlkLFxuICAgICAgICBkZXNjcmlwdGlvbjogYEhvc3RlZCBab25lIElEIGZvciAke3pvbmVOYW1lfWAsXG4gICAgICAgIGV4cG9ydE5hbWUsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBuYW1lU2VydmVycygpOiBzdHJpbmdbXSB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKHRoaXMuaXNJbXBvcnRlZCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICByZXR1cm4gdGhpcy5ob3N0ZWRab25lLmhvc3RlZFpvbmVOYW1lU2VydmVycztcbiAgfVxuXG4gIGFkZE5zUmVjb3JkKHJlY29yZE5hbWU6IHN0cmluZywgdGFyZ2V0TmFtZVNlcnZlcnM6IHN0cmluZ1tdLCB0dGw6IER1cmF0aW9uKTogcm91dGU1My5Oc1JlY29yZCB7XG4gICAgcmV0dXJuIG5ldyByb3V0ZTUzLk5zUmVjb3JkKHRoaXMsIGBOU1JlY29yZC0ke3Nhbml0aXplQ29uc3RydWN0SWRTdWZmaXgocmVjb3JkTmFtZSl9YCwge1xuICAgICAgem9uZTogdGhpcy5ob3N0ZWRab25lLFxuICAgICAgcmVjb3JkTmFtZSxcbiAgICAgIHZhbHVlczogdGFyZ2V0TmFtZVNlcnZlcnMsXG4gICAgICB0dGwsXG4gICAgfSk7XG4gIH1cblxuICBhZGRDbmFtZVJlY29yZChyZWNvcmROYW1lOiBzdHJpbmcsIGRvbWFpbk5hbWU6IHN0cmluZywgdHRsOiBEdXJhdGlvbik6IHJvdXRlNTMuQ25hbWVSZWNvcmQge1xuICAgIHJldHVybiBuZXcgcm91dGU1My5DbmFtZVJlY29yZCh0aGlzLCBgQ05BTUVSZWNvcmQtJHtzYW5pdGl6ZUNvbnN0cnVjdElkU3VmZml4KHJlY29yZE5hbWUpfWAsIHtcbiAgICAgIHpvbmU6IHRoaXMuaG9zdGVkWm9uZSxcbiAgICAgIHJlY29yZE5hbWUsXG4gICAgICBkb21haW5OYW1lLFxuICAgICAgdHRsLFxuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNhbml0aXplQ2xvdWRGb3JtYXRpb25FeHBvcnROYW1lKG5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IGlucHV0ID0gU3RyaW5nKG5hbWUgPz8gXCJcIikudHJpbSgpO1xuICBpZiAoIWlucHV0KSByZXR1cm4gXCJleHBvcnRcIjtcblxuICBsZXQgb3V0ID0gXCJcIjtcbiAgbGV0IGxhc3RXYXNEYXNoID0gZmFsc2U7XG5cbiAgZm9yIChjb25zdCByIG9mIGlucHV0KSB7XG4gICAgY29uc3QgaXNBbGxvd2VkID1cbiAgICAgIChyID49IFwiYVwiICYmIHIgPD0gXCJ6XCIpIHx8XG4gICAgICAociA+PSBcIkFcIiAmJiByIDw9IFwiWlwiKSB8fFxuICAgICAgKHIgPj0gXCIwXCIgJiYgciA8PSBcIjlcIikgfHxcbiAgICAgIHIgPT09IFwiOlwiIHx8XG4gICAgICByID09PSBcIi1cIjtcbiAgICBpZiAoaXNBbGxvd2VkKSB7XG4gICAgICBvdXQgKz0gcjtcbiAgICAgIGxhc3RXYXNEYXNoID0gciA9PT0gXCItXCI7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKCFsYXN0V2FzRGFzaCkge1xuICAgICAgb3V0ICs9IFwiLVwiO1xuICAgICAgbGFzdFdhc0Rhc2ggPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIG91dCA9IG91dC5yZXBsYWNlKC9eLSsvLCBcIlwiKS5yZXBsYWNlKC8tKyQvLCBcIlwiKTtcbiAgcmV0dXJuIG91dCA/IG91dCA6IFwiZXhwb3J0XCI7XG59XG5cbmZ1bmN0aW9uIHNhbml0aXplQ29uc3RydWN0SWRTdWZmaXgoaW5wdXQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHJhdyA9IFN0cmluZyhpbnB1dCA/PyBcIlwiKS50cmltKCk7XG4gIGlmICghcmF3KSByZXR1cm4gXCJyZWNvcmRcIjtcbiAgY29uc3Qgb3V0ID0gcmF3LnJlcGxhY2UoL1teYS16QS1aMC05XSsvZywgXCItXCIpLnJlcGxhY2UoL14tKy8sIFwiXCIpLnJlcGxhY2UoLy0rJC8sIFwiXCIpO1xuICByZXR1cm4gb3V0ID8gb3V0IDogXCJyZWNvcmRcIjtcbn1cbiJdfQ==