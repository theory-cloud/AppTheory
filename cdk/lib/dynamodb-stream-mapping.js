"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AppTheoryDynamoDBStreamMapping = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const lambda = require("aws-cdk-lib/aws-lambda");
const lambdaEventSources = require("aws-cdk-lib/aws-lambda-event-sources");
const constructs_1 = require("constructs");
class AppTheoryDynamoDBStreamMapping extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        props.consumer.addEventSource(new lambdaEventSources.DynamoEventSource(props.table, {
            startingPosition: props.startingPosition ?? lambda.StartingPosition.LATEST,
            batchSize: props.batchSize,
            bisectBatchOnError: props.bisectBatchOnError,
            parallelizationFactor: props.parallelizationFactor,
            retryAttempts: props.retryAttempts,
            maxBatchingWindow: props.maxBatchingWindow,
            maxRecordAge: props.maxRecordAge,
            reportBatchItemFailures: props.reportBatchItemFailures ?? true,
        }));
        props.table.grantStreamRead(props.consumer);
    }
}
exports.AppTheoryDynamoDBStreamMapping = AppTheoryDynamoDBStreamMapping;
_a = JSII_RTTI_SYMBOL_1;
AppTheoryDynamoDBStreamMapping[_a] = { fqn: "@theory-cloud/apptheory-cdk.AppTheoryDynamoDBStreamMapping", version: "0.7.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1vZGItc3RyZWFtLW1hcHBpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkeW5hbW9kYi1zdHJlYW0tbWFwcGluZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLGlEQUFpRDtBQUNqRCwyRUFBMkU7QUFDM0UsMkNBQXVDO0FBZXZDLE1BQWEsOEJBQStCLFNBQVEsc0JBQVM7SUFDM0QsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUEwQztRQUNsRixLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpCLEtBQUssQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUMzQixJQUFJLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUU7WUFDcEQsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNO1lBQzFFLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztZQUMxQixrQkFBa0IsRUFBRSxLQUFLLENBQUMsa0JBQWtCO1lBQzVDLHFCQUFxQixFQUFFLEtBQUssQ0FBQyxxQkFBcUI7WUFDbEQsYUFBYSxFQUFFLEtBQUssQ0FBQyxhQUFhO1lBQ2xDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxpQkFBaUI7WUFDMUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZO1lBQ2hDLHVCQUF1QixFQUFFLEtBQUssQ0FBQyx1QkFBdUIsSUFBSSxJQUFJO1NBQy9ELENBQUMsQ0FDSCxDQUFDO1FBRUYsS0FBSyxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzlDLENBQUM7O0FBbEJILHdFQW1CQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgRHVyYXRpb24gfSBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCB0eXBlICogYXMgZHluYW1vZGIgZnJvbSBcImF3cy1jZGstbGliL2F3cy1keW5hbW9kYlwiO1xuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtbGFtYmRhXCI7XG5pbXBvcnQgKiBhcyBsYW1iZGFFdmVudFNvdXJjZXMgZnJvbSBcImF3cy1jZGstbGliL2F3cy1sYW1iZGEtZXZlbnQtc291cmNlc1wiO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBBcHBUaGVvcnlEeW5hbW9EQlN0cmVhbU1hcHBpbmdQcm9wcyB7XG4gIHJlYWRvbmx5IGNvbnN1bWVyOiBsYW1iZGEuRnVuY3Rpb247XG4gIHJlYWRvbmx5IHRhYmxlOiBkeW5hbW9kYi5JVGFibGU7XG4gIHJlYWRvbmx5IHN0YXJ0aW5nUG9zaXRpb24/OiBsYW1iZGEuU3RhcnRpbmdQb3NpdGlvbjtcbiAgcmVhZG9ubHkgYmF0Y2hTaXplPzogbnVtYmVyO1xuICByZWFkb25seSBiaXNlY3RCYXRjaE9uRXJyb3I/OiBib29sZWFuO1xuICByZWFkb25seSBwYXJhbGxlbGl6YXRpb25GYWN0b3I/OiBudW1iZXI7XG4gIHJlYWRvbmx5IHJldHJ5QXR0ZW1wdHM/OiBudW1iZXI7XG4gIHJlYWRvbmx5IG1heEJhdGNoaW5nV2luZG93PzogRHVyYXRpb247XG4gIHJlYWRvbmx5IG1heFJlY29yZEFnZT86IER1cmF0aW9uO1xuICByZWFkb25seSByZXBvcnRCYXRjaEl0ZW1GYWlsdXJlcz86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBBcHBUaGVvcnlEeW5hbW9EQlN0cmVhbU1hcHBpbmcgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQXBwVGhlb3J5RHluYW1vREJTdHJlYW1NYXBwaW5nUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgcHJvcHMuY29uc3VtZXIuYWRkRXZlbnRTb3VyY2UoXG4gICAgICBuZXcgbGFtYmRhRXZlbnRTb3VyY2VzLkR5bmFtb0V2ZW50U291cmNlKHByb3BzLnRhYmxlLCB7XG4gICAgICAgIHN0YXJ0aW5nUG9zaXRpb246IHByb3BzLnN0YXJ0aW5nUG9zaXRpb24gPz8gbGFtYmRhLlN0YXJ0aW5nUG9zaXRpb24uTEFURVNULFxuICAgICAgICBiYXRjaFNpemU6IHByb3BzLmJhdGNoU2l6ZSxcbiAgICAgICAgYmlzZWN0QmF0Y2hPbkVycm9yOiBwcm9wcy5iaXNlY3RCYXRjaE9uRXJyb3IsXG4gICAgICAgIHBhcmFsbGVsaXphdGlvbkZhY3RvcjogcHJvcHMucGFyYWxsZWxpemF0aW9uRmFjdG9yLFxuICAgICAgICByZXRyeUF0dGVtcHRzOiBwcm9wcy5yZXRyeUF0dGVtcHRzLFxuICAgICAgICBtYXhCYXRjaGluZ1dpbmRvdzogcHJvcHMubWF4QmF0Y2hpbmdXaW5kb3csXG4gICAgICAgIG1heFJlY29yZEFnZTogcHJvcHMubWF4UmVjb3JkQWdlLFxuICAgICAgICByZXBvcnRCYXRjaEl0ZW1GYWlsdXJlczogcHJvcHMucmVwb3J0QmF0Y2hJdGVtRmFpbHVyZXMgPz8gdHJ1ZSxcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICBwcm9wcy50YWJsZS5ncmFudFN0cmVhbVJlYWQocHJvcHMuY29uc3VtZXIpO1xuICB9XG59XG4iXX0=