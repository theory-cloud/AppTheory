"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AppTheoryDynamoDBStreamMapping = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const lambda = require("aws-cdk-lib/aws-lambda");
const lambdaEventSources = require("aws-cdk-lib/aws-lambda-event-sources");
const constructs_1 = require("constructs");
class AppTheoryDynamoDBStreamMapping extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        props.consumer.addEventSource(new lambdaEventSources.DynamoEventSource(props.table, {
            startingPosition: props.startingPosition ?? lambda.StartingPosition.LATEST,
            batchSize: props.batchSize,
            bisectBatchOnError: props.bisectBatchOnError,
            retryAttempts: props.retryAttempts,
            maxRecordAge: props.maxRecordAge,
            reportBatchItemFailures: props.reportBatchItemFailures ?? true,
        }));
        props.table.grantStreamRead(props.consumer);
    }
}
exports.AppTheoryDynamoDBStreamMapping = AppTheoryDynamoDBStreamMapping;
_a = JSII_RTTI_SYMBOL_1;
AppTheoryDynamoDBStreamMapping[_a] = { fqn: "@theory-cloud/apptheory-cdk.AppTheoryDynamoDBStreamMapping", version: "0.2.0-rc.5" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1vZGItc3RyZWFtLW1hcHBpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkeW5hbW9kYi1zdHJlYW0tbWFwcGluZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLGlEQUFpRDtBQUNqRCwyRUFBMkU7QUFDM0UsMkNBQXVDO0FBYXZDLE1BQWEsOEJBQStCLFNBQVEsc0JBQVM7SUFDM0QsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUEwQztRQUNsRixLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpCLEtBQUssQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUMzQixJQUFJLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUU7WUFDcEQsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNO1lBQzFFLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztZQUMxQixrQkFBa0IsRUFBRSxLQUFLLENBQUMsa0JBQWtCO1lBQzVDLGFBQWEsRUFBRSxLQUFLLENBQUMsYUFBYTtZQUNsQyxZQUFZLEVBQUUsS0FBSyxDQUFDLFlBQVk7WUFDaEMsdUJBQXVCLEVBQUUsS0FBSyxDQUFDLHVCQUF1QixJQUFJLElBQUk7U0FDL0QsQ0FBQyxDQUNILENBQUM7UUFFRixLQUFLLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDOUMsQ0FBQzs7QUFoQkgsd0VBaUJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBEdXJhdGlvbiB9IGZyb20gXCJhd3MtY2RrLWxpYlwiO1xuaW1wb3J0IHR5cGUgKiBhcyBkeW5hbW9kYiBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWR5bmFtb2RiXCI7XG5pbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSBcImF3cy1jZGstbGliL2F3cy1sYW1iZGFcIjtcbmltcG9ydCAqIGFzIGxhbWJkYUV2ZW50U291cmNlcyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWxhbWJkYS1ldmVudC1zb3VyY2VzXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tIFwiY29uc3RydWN0c1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEFwcFRoZW9yeUR5bmFtb0RCU3RyZWFtTWFwcGluZ1Byb3BzIHtcbiAgcmVhZG9ubHkgY29uc3VtZXI6IGxhbWJkYS5GdW5jdGlvbjtcbiAgcmVhZG9ubHkgdGFibGU6IGR5bmFtb2RiLklUYWJsZTtcbiAgcmVhZG9ubHkgc3RhcnRpbmdQb3NpdGlvbj86IGxhbWJkYS5TdGFydGluZ1Bvc2l0aW9uO1xuICByZWFkb25seSBiYXRjaFNpemU/OiBudW1iZXI7XG4gIHJlYWRvbmx5IGJpc2VjdEJhdGNoT25FcnJvcj86IGJvb2xlYW47XG4gIHJlYWRvbmx5IHJldHJ5QXR0ZW1wdHM/OiBudW1iZXI7XG4gIHJlYWRvbmx5IG1heFJlY29yZEFnZT86IER1cmF0aW9uO1xuICByZWFkb25seSByZXBvcnRCYXRjaEl0ZW1GYWlsdXJlcz86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBBcHBUaGVvcnlEeW5hbW9EQlN0cmVhbU1hcHBpbmcgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQXBwVGhlb3J5RHluYW1vREJTdHJlYW1NYXBwaW5nUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgcHJvcHMuY29uc3VtZXIuYWRkRXZlbnRTb3VyY2UoXG4gICAgICBuZXcgbGFtYmRhRXZlbnRTb3VyY2VzLkR5bmFtb0V2ZW50U291cmNlKHByb3BzLnRhYmxlLCB7XG4gICAgICAgIHN0YXJ0aW5nUG9zaXRpb246IHByb3BzLnN0YXJ0aW5nUG9zaXRpb24gPz8gbGFtYmRhLlN0YXJ0aW5nUG9zaXRpb24uTEFURVNULFxuICAgICAgICBiYXRjaFNpemU6IHByb3BzLmJhdGNoU2l6ZSxcbiAgICAgICAgYmlzZWN0QmF0Y2hPbkVycm9yOiBwcm9wcy5iaXNlY3RCYXRjaE9uRXJyb3IsXG4gICAgICAgIHJldHJ5QXR0ZW1wdHM6IHByb3BzLnJldHJ5QXR0ZW1wdHMsXG4gICAgICAgIG1heFJlY29yZEFnZTogcHJvcHMubWF4UmVjb3JkQWdlLFxuICAgICAgICByZXBvcnRCYXRjaEl0ZW1GYWlsdXJlczogcHJvcHMucmVwb3J0QmF0Y2hJdGVtRmFpbHVyZXMgPz8gdHJ1ZSxcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICBwcm9wcy50YWJsZS5ncmFudFN0cmVhbVJlYWQocHJvcHMuY29uc3VtZXIpO1xuICB9XG59XG5cbiJdfQ==